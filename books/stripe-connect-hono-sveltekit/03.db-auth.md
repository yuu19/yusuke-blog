---
title: D1(Drizzle)スキーマとBetter Auth統合
---

# D1(Drizzle)スキーマとBetter Auth統合

この章では、認証テーブルとアプリ固有テーブルを D1 に定義し、Better Auth を Drizzle adapter 経由で接続します。

章対応コミット:

- DB実装: https://github.com/yuu19/stripe-connect-hono-sveltekit-demo/commit/732df20fbf20746500909b4bc485a915a5310c9c
- Web側Auth統合: https://github.com/yuu19/stripe-connect-hono-sveltekit-demo/commit/4228be41637f49649c475fadd18f07e261edc9d1

## テーブル設計

### Better Auth標準

- `user`
- `session`
- `account`
- `verification`

### アプリ固有

- `seller_profile`
- `checkout_order`
- `stripe_event`

`stripe_event` を持つことで、Webhook再送時の重複処理を避けます。

## マイグレーション適用

```bash
pnpm d1:migrate:local
pnpm seed
```

## Better Auth + Drizzle adapter

`apps/web/src/lib/server/auth.ts` で、D1をDrizzle化して Better Auth に渡します。

```ts
const drizzle = createDb(db);

database: drizzleAdapter(drizzle, {
  provider: 'sqlite',
  schema: {
    user: users,
    session: sessions,
    account: accounts,
    verification: verifications
  }
})
```

この形にすると、認証もアプリデータも同じ D1 上で一貫管理できます。
