---
title: SvelteKit Workerから内部APIを安全に呼ぶ
---

# SvelteKit Workerから内部APIを安全に呼ぶ

この章では、ブラウザから直接 API Worker を触らず、Web Worker 経由に統一します。

章対応コミット:

- Web実装: https://github.com/yuu19/stripe-connect-hono-sveltekit-demo/commit/4228be41637f49649c475fadd18f07e261edc9d1

## 方針

- ブラウザは `apps/web` の `/api/*` だけ叩く
- `apps/web` が `API_SERVICE`（Service Binding）で `apps/api` を呼ぶ
- fallback として `PRIVATE_API_BASE_URL` を許可（ローカル開発）

## 実装ポイント

`apps/web/src/lib/server/internalApi.ts`:

- `x-internal-token` を付与
- Service Binding があればそれを優先
- なければ `PRIVATE_API_BASE_URL` に POST

## 画面フロー

`/dashboard` で以下3操作をボタン化しています。

1. Connected Account 作成
2. Onboarding Link 生成
3. 500円 Checkout 開始

また `GET /api/me` で現在の seller profile と注文状態を確認できます。
